# Candlefish AI Secrets Credential Mapping
# Generated: 2025-09-05
# Purpose: Track all credentials, their locations, dependencies, and rotation status

version: 1.0.0
generated: 2025-09-05T00:00:00Z

# ============================================
# COMPROMISED CREDENTIALS (TO BE REVOKED)
# ============================================

compromised_credentials:
  aws:
    - service: AWS IAM
      key_id: AKIAZ5G4HRQHZIBGMDNM
      exposure_date: 2025-09-04
      status: ACTIVE_COMPROMISED
      action: REVOKE_IMMEDIATE
      affected_services:
        - S3 buckets
        - Lambda functions
        - Secrets Manager
        - CloudWatch
      revocation_steps:
        - Login to AWS Console
        - Navigate to IAM > Users
        - Find user associated with key
        - Deactivate access key
        - Create new access key
        - Update all services

  mongodb:
    - service: MongoDB Atlas
      username: mihirsheth2911
      cluster: candlefish-cluster
      exposure_date: 2025-09-04
      status: ACTIVE_COMPROMISED
      action: DELETE_USER
      affected_services:
        - clos/api-server
        - projects/promoterOS
        - analytics-service
      migration_steps:
        - Login to MongoDB Atlas
        - Create new user candlefish_admin_20250904
        - Grant same permissions
        - Update connection strings
        - Delete old user

  google:
    - service: Google Cloud APIs
      api_key: AIzaSyBGHmF2vC4R8tX9pQ6jK3nM7wE1sA5yZ2B
      exposure_date: 2025-09-04
      status: ACTIVE_COMPROMISED
      action: REVOKE_REGENERATE
      affected_apis:
        - Maps API
        - Places API
        - Geocoding API
      revocation_steps:
        - Access Google Cloud Console
        - Navigate to APIs & Services > Credentials
        - Delete exposed key
        - Create new API key
        - Apply restrictions

  smithery:
    - service: Smithery API
      api_key: bfcb8cec-9d56-4957-8156-bced0bfca532
      exposure_date: 2025-09-04
      status: ACTIVE_COMPROMISED
      action: REVOKE
      affected_services:
        - projects/paintbox
      new_key: 55f3f737-0a09-49e8-a2f7-d1fd035bf7b7

# ============================================
# NEW EMERGENCY CREDENTIALS (TEMPORARY)
# ============================================

emergency_credentials:
  location: /Users/patricksmith/.candlefish-secrets-20250904-212216/
  expiry: 2025-10-04T21:22:00Z  # 30 days
  
  credentials:
    mongodb:
      username: candlefish_admin_20250904
      password_location: .env.new
      connection_string: "mongodb+srv://candlefish_admin_20250904:<password>@candlefish-cluster.mongodb.net"
      services_requiring_update:
        - clos/api-server/.env
        - projects/promoterOS/.env
        - analytics-service/.env

    smithery_api:
      api_key: 55f3f737-0a09-49e8-a2f7-d1fd035bf7b7
      location: new-secrets.json
      services_requiring_update:
        - projects/paintbox/.env

    jwt_secret:
      location: new-secrets.json
      length: 64_chars
      encoding: base64
      services_requiring_update:
        - clos/api-server/.env
        - apps/collaboration-editor/.env
        - brand/website/.env

    encryption_key:
      location: new-secrets.json
      algorithm: AES-256
      length: 32_bytes
      services_requiring_update:
        - clos/api-server/.env
        - infrastructure/secrets-management/config.yaml

# ============================================
# SERVICE DEPENDENCIES MAP
# ============================================

service_dependencies:
  clos_api_server:
    path: clos/api-server
    env_file: .env
    required_secrets:
      - AWS_ACCESS_KEY_ID
      - AWS_SECRET_ACCESS_KEY
      - MONGODB_URI
      - JWT_SECRET
      - ENCRYPTION_KEY
      - REDIS_URL
      - OPENAI_API_KEY
    migration_priority: CRITICAL
    downtime_tolerance: 0_minutes

  promoter_os:
    path: projects/promoterOS
    env_file: .env.local
    required_secrets:
      - MONGODB_URI
      - NEXTAUTH_SECRET
      - TIKTOK_API_KEY
      - AWS_S3_BUCKET
    migration_priority: HIGH
    downtime_tolerance: 5_minutes

  paintbox:
    path: projects/paintbox
    env_file: .env
    required_secrets:
      - SMITHERY_API_KEY
      - AWS_BEDROCK_ACCESS
      - ANTHROPIC_API_KEY
    migration_priority: MEDIUM
    downtime_tolerance: 15_minutes

  brand_website:
    path: brand/website
    env_file: .env.local
    required_secrets:
      - JWT_SECRET
      - NEXT_PUBLIC_API_URL
      - ANALYTICS_KEY
    migration_priority: LOW
    downtime_tolerance: 30_minutes

  collaboration_editor:
    path: apps/collaboration-editor
    env_file: .env
    required_secrets:
      - JWT_SECRET
      - GRAPHQL_ENDPOINT
      - WEBSOCKET_URL
    migration_priority: MEDIUM
    downtime_tolerance: 10_minutes

# ============================================
# FUTURE STATE (POST-DEPLOYMENT)
# ============================================

target_architecture:
  aws_secrets_manager:
    secrets:
      - /candlefish/prod/database/mongodb
      - /candlefish/prod/api/openai
      - /candlefish/prod/api/anthropic
      - /candlefish/prod/api/tiktok
      - /candlefish/prod/api/smithery
    rotation:
      automatic: true
      frequency_days: 30
    access_method: SDK

  vault_paths:
    dynamic_credentials:
      - database/creds/mongodb-reader
      - database/creds/mongodb-writer
      - aws/creds/s3-access
    transit_encryption:
      - transit/encrypt/customer-data
      - transit/sign/api-requests
    pki:
      - pki/issue/internal-services
      - pki/issue/client-certificates

  sealed_secrets:
    namespace: default
    controller: sealed-secrets-controller
    scope: cluster-wide
    secrets:
      - application-config
      - tls-certificates
      - docker-registry

# ============================================
# ROTATION SCHEDULE
# ============================================

rotation_schedule:
  immediate:  # Within 24 hours
    - AWS IAM credentials
    - MongoDB user credentials
    - Google API keys
    - Smithery API keys

  week_1:  # Days 1-7
    - JWT secrets
    - Encryption keys
    - Redis passwords
    - Session secrets

  week_2:  # Days 8-14
    - OpenAI API keys
    - Anthropic API keys
    - TikTok API keys
    - Analytics keys

  week_3:  # Days 15-21
    - TLS certificates
    - OAuth client secrets
    - Webhook secrets
    - Service account keys

  week_4:  # Days 22-30
    - Final verification
    - Legacy cleanup
    - Documentation update
    - Audit compliance

# ============================================
# VALIDATION CHECKLIST
# ============================================

validation:
  pre_rotation:
    - Backup all current .env files
    - Document all service dependencies
    - Notify all teams
    - Prepare rollback plan

  during_rotation:
    - Monitor service health
    - Check error logs
    - Verify connectivity
    - Test authentication

  post_rotation:
    - Confirm all services operational
    - Verify old credentials revoked
    - Update documentation
    - Security audit

# ============================================
# EMERGENCY CONTACTS
# ============================================

contacts:
  security_team:
    slack: "#security"
    email: security@candlefish.ai
    oncall: security-oncall@candlefish.ai

  platform_team:
    slack: "#platform-alerts"
    email: platform@candlefish.ai
    oncall: platform-oncall@candlefish.ai

  escalation:
    cto: cto@candlefish.ai
    security_lead: security-lead@candlefish.ai
    break_glass: +1-555-SEC-RETS