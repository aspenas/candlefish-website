<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" width="1200" height="800" viewBox="0 0 1200 800">
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#333" />
    </marker>
    <pattern id="stripes" patternUnits="userSpaceOnUse" width="4" height="4">
      <path d="M 0 0 L 4 4 M -1 3 L 3 7 M 1 -1 L 5 3" stroke="#e0e0e0" stroke-width="0.5"/>
    </pattern>
  </defs>

  <!-- Title -->
  <text x="600" y="30" font-family="Arial, sans-serif" font-size="24" font-weight="bold" text-anchor="middle">
    Candlefish.ai Data Flow Architecture
  </text>

  <!-- Trust Boundaries -->
  <!-- Public Internet -->
  <rect x="50" y="60" width="1100" height="150" fill="#ffe0e0" stroke="#cc0000" stroke-width="2" stroke-dasharray="5,5" rx="5"/>
  <text x="70" y="85" font-family="Arial" font-size="14" font-weight="bold" fill="#cc0000">Public Internet (Untrusted)</text>

  <!-- Semi-trusted Perimeter -->
  <rect x="50" y="230" width="1100" height="200" fill="#fff0e0" stroke="#ff9900" stroke-width="2" stroke-dasharray="5,5" rx="5"/>
  <text x="70" y="255" font-family="Arial" font-size="14" font-weight="bold" fill="#ff9900">Semi-trusted Perimeter</text>

  <!-- Internal Network -->
  <rect x="50" y="450" width="1100" height="200" fill="#e0f0e0" stroke="#009900" stroke-width="2" stroke-dasharray="5,5" rx="5"/>
  <text x="70" y="475" font-family="Arial" font-size="14" font-weight="bold" fill="#009900">Internal Network (Trusted)</text>

  <!-- Data Layer -->
  <rect x="50" y="670" width="1100" height="100" fill="#e0e0f0" stroke="#0066cc" stroke-width="2" stroke-dasharray="5,5" rx="5"/>
  <text x="70" y="695" font-family="Arial" font-size="14" font-weight="bold" fill="#0066cc">Sensitive Data Layer</text>

  <!-- Components -->
  <!-- User Browser -->
  <rect x="200" y="100" width="120" height="80" fill="#ffffff" stroke="#333" stroke-width="2" rx="5"/>
  <text x="260" y="130" font-family="Arial" font-size="12" text-anchor="middle" font-weight="bold">User Browser</text>
  <text x="260" y="150" font-family="Arial" font-size="10" text-anchor="middle">React App</text>
  <text x="260" y="165" font-family="Arial" font-size="10" text-anchor="middle">LocalStorage</text>

  <!-- Mobile App -->
  <rect x="350" y="100" width="120" height="80" fill="#ffffff" stroke="#333" stroke-width="2" rx="5"/>
  <text x="410" y="130" font-family="Arial" font-size="12" text-anchor="middle" font-weight="bold">Mobile App</text>
  <text x="410" y="150" font-family="Arial" font-size="10" text-anchor="middle">React Native</text>
  <text x="410" y="165" font-family="Arial" font-size="10" text-anchor="middle">SQLite</text>

  <!-- CloudFlare -->
  <rect x="500" y="270" width="150" height="80" fill="#f0f0f0" stroke="#333" stroke-width="2" rx="5"/>
  <text x="575" y="300" font-family="Arial" font-size="12" text-anchor="middle" font-weight="bold">CloudFlare</text>
  <text x="575" y="320" font-family="Arial" font-size="10" text-anchor="middle">WAF / DDoS</text>
  <text x="575" y="335" font-family="Arial" font-size="10" text-anchor="middle">CDN Cache</text>

  <!-- API Gateway -->
  <rect x="700" y="270" width="150" height="80" fill="#f0f0f0" stroke="#333" stroke-width="2" rx="5"/>
  <text x="775" y="300" font-family="Arial" font-size="12" text-anchor="middle" font-weight="bold">API Gateway</text>
  <text x="775" y="320" font-family="Arial" font-size="10" text-anchor="middle">Kong / Envoy</text>
  <text x="775" y="335" font-family="Arial" font-size="10" text-anchor="middle">Rate Limiting</text>

  <!-- Load Balancer -->
  <rect x="900" y="270" width="150" height="80" fill="#f0f0f0" stroke="#333" stroke-width="2" rx="5"/>
  <text x="975" y="300" font-family="Arial" font-size="12" text-anchor="middle" font-weight="bold">Load Balancer</text>
  <text x="975" y="320" font-family="Arial" font-size="10" text-anchor="middle">SSL Termination</text>
  <text x="975" y="335" font-family="Arial" font-size="10" text-anchor="middle">Health Checks</text>

  <!-- GraphQL API -->
  <rect x="200" y="500" width="130" height="80" fill="#e0f0ff" stroke="#333" stroke-width="2" rx="5"/>
  <text x="265" y="530" font-family="Arial" font-size="12" text-anchor="middle" font-weight="bold">GraphQL API</text>
  <text x="265" y="550" font-family="Arial" font-size="10" text-anchor="middle">Apollo Server</text>
  <text x="265" y="565" font-family="Arial" font-size="10" text-anchor="middle">Resolvers</text>

  <!-- REST API -->
  <rect x="360" y="500" width="130" height="80" fill="#e0f0ff" stroke="#333" stroke-width="2" rx="5"/>
  <text x="425" y="530" font-family="Arial" font-size="12" text-anchor="middle" font-weight="bold">REST API</text>
  <text x="425" y="550" font-family="Arial" font-size="10" text-anchor="middle">Express</text>
  <text x="425" y="565" font-family="Arial" font-size="10" text-anchor="middle">Middleware</text>

  <!-- WebSocket -->
  <rect x="520" y="500" width="130" height="80" fill="#e0f0ff" stroke="#333" stroke-width="2" rx="5"/>
  <text x="585" y="530" font-family="Arial" font-size="12" text-anchor="middle" font-weight="bold">WebSocket</text>
  <text x="585" y="550" font-family="Arial" font-size="10" text-anchor="middle">Socket.io</text>
  <text x="585" y="565" font-family="Arial" font-size="10" text-anchor="middle">Real-time</text>

  <!-- Auth Service -->
  <rect x="680" y="500" width="130" height="80" fill="#ffe0ff" stroke="#333" stroke-width="2" rx="5"/>
  <text x="745" y="530" font-family="Arial" font-size="12" text-anchor="middle" font-weight="bold">Auth Service</text>
  <text x="745" y="550" font-family="Arial" font-size="10" text-anchor="middle">JWT</text>
  <text x="745" y="565" font-family="Arial" font-size="10" text-anchor="middle">MFA</text>

  <!-- Worker Queue -->
  <rect x="840" y="500" width="130" height="80" fill="#ffe0ff" stroke="#333" stroke-width="2" rx="5"/>
  <text x="905" y="530" font-family="Arial" font-size="12" text-anchor="middle" font-weight="bold">Worker Queue</text>
  <text x="905" y="550" font-family="Arial" font-size="10" text-anchor="middle">Bull/Redis</text>
  <text x="905" y="565" font-family="Arial" font-size="10" text-anchor="middle">Async Jobs</text>

  <!-- Cache -->
  <rect x="1000" y="500" width="130" height="80" fill="#ffe0ff" stroke="#333" stroke-width="2" rx="5"/>
  <text x="1065" y="530" font-family="Arial" font-size="12" text-anchor="middle" font-weight="bold">Cache</text>
  <text x="1065" y="550" font-family="Arial" font-size="10" text-anchor="middle">Redis</text>
  <text x="1065" y="565" font-family="Arial" font-size="10" text-anchor="middle">Sessions</text>

  <!-- Database -->
  <rect x="300" y="700" width="150" height="50" fill="#d0d0ff" stroke="#333" stroke-width="2" rx="5"/>
  <text x="375" y="730" font-family="Arial" font-size="12" text-anchor="middle" font-weight="bold">PostgreSQL</text>

  <!-- Object Storage -->
  <rect x="500" y="700" width="150" height="50" fill="#d0d0ff" stroke="#333" stroke-width="2" rx="5"/>
  <text x="575" y="730" font-family="Arial" font-size="12" text-anchor="middle" font-weight="bold">S3 Storage</text>

  <!-- Secrets -->
  <rect x="700" y="700" width="150" height="50" fill="#ffd0d0" stroke="#333" stroke-width="2" rx="5"/>
  <text x="775" y="730" font-family="Arial" font-size="12" text-anchor="middle" font-weight="bold">Secrets (KMS)</text>

  <!-- Audit Logs -->
  <rect x="900" y="700" width="150" height="50" fill="#d0d0ff" stroke="#333" stroke-width="2" rx="5"/>
  <text x="975" y="730" font-family="Arial" font-size="12" text-anchor="middle" font-weight="bold">Audit Logs</text>

  <!-- Data Flow Arrows -->
  <!-- User to CloudFlare -->
  <path d="M 260 180 L 575 270" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="400" y="220" font-family="Arial" font-size="10" fill="#666">HTTPS/TLS 1.3</text>

  <!-- Mobile to CloudFlare -->
  <path d="M 410 180 L 575 270" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>

  <!-- CloudFlare to API Gateway -->
  <path d="M 650 310 L 700 310" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="675" y="300" font-family="Arial" font-size="10" fill="#666">Filter</text>

  <!-- API Gateway to Load Balancer -->
  <path d="M 850 310 L 900 310" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="875" y="300" font-family="Arial" font-size="10" fill="#666">Route</text>

  <!-- Load Balancer to Services -->
  <path d="M 975 350 L 265 500" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  <path d="M 975 350 L 425 500" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  <path d="M 975 350 L 585 500" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  <path d="M 975 350 L 745 500" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="600" y="420" font-family="Arial" font-size="10" fill="#666">mTLS</text>

  <!-- Services to Data -->
  <path d="M 265 580 L 375 700" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  <path d="M 425 580 L 375 700" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  <path d="M 585 580 L 575 700" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  <path d="M 745 580 L 775 700" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  <path d="M 905 580 L 975 700" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  <path d="M 1065 580 L 975 700" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>

  <!-- Security Annotations -->
  <circle cx="320" cy="240" r="15" fill="#ff0000" opacity="0.3"/>
  <text x="340" y="245" font-family="Arial" font-size="10" fill="#ff0000">CSRF</text>

  <circle cx="675" cy="380" r="15" fill="#ff0000" opacity="0.3"/>
  <text x="695" y="385" font-family="Arial" font-size="10" fill="#ff0000">Rate</text>

  <circle cx="375" cy="650" r="15" fill="#ff0000" opacity="0.3"/>
  <text x="395" y="655" font-family="Arial" font-size="10" fill="#ff0000">Encrypt</text>

  <!-- Legend -->
  <g transform="translate(50, 780)">
    <text x="0" y="0" font-family="Arial" font-size="12" font-weight="bold">Legend:</text>
    <rect x="100" y="-10" width="30" height="10" fill="#ffe0e0"/>
    <text x="135" y="0" font-family="Arial" font-size="10">Untrusted</text>

    <rect x="200" y="-10" width="30" height="10" fill="#fff0e0"/>
    <text x="235" y="0" font-family="Arial" font-size="10">Semi-trusted</text>

    <rect x="320" y="-10" width="30" height="10" fill="#e0f0e0"/>
    <text x="355" y="0" font-family="Arial" font-size="10">Trusted</text>

    <rect x="420" y="-10" width="30" height="10" fill="#e0e0f0"/>
    <text x="455" y="0" font-family="Arial" font-size="10">Sensitive</text>

    <circle cx="540" cy="-5" r="5" fill="#ff0000" opacity="0.3"/>
    <text x="550" y="0" font-family="Arial" font-size="10">Security Control Point</text>
  </g>
</svg>
